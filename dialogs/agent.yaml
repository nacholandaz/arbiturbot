initial_user_message:
    type: 'text'
    text: 'User generated text'
    next_interaction: start

start:
    type: 'text'
    text: 'Hola ${name} üôã‚Äç‚ôÄ'
    requires_user_response: 'false'
    next_interaction: 'presentation'

presentation:
    type: 'text'
    text: 'Soy Arbi, estoy aqu√≠ para lo que necesites!'
    requires_user_response: 'false'
    next_interaction: 'agent_options'

general_interface:
    type: 'conversational_interface'
    text: "Actualmente no te encuentras hablando con nadie"
    requires_user_response: 'true'
    available_commands: {
        '+u':  add_user,
        'u':  move_to_user,
        'ls': list_users, #TBD
        'c':  list_cases, #TBD
        '?': get_help,
    }
    next_interaction_failure: error_command
    save_field_context:
        field: conversational_level
        value: general

get_help:
    type: 'text'
    text: "+u - loop de generar usuario - flow con retro\nu - moverse a un usuario - setup \nls- listar usuarios - flow sin retro\nc - listar casos - flow sin retro\n? - Obtener ayuda  - flow sin retro"
    requires_user_response: 'false'
    next_interaction: general_interface

user_interface:
    type: 'conversational_interface'
    text: "Actualmente te encuentras hablando con ${redirect_user} (${redirect_phone})"
    requires_user_response: 'true'
    available_commands: {
        '+u': add_user,
        'u': move_to_user,
        'm': message_user,
        'ls': list_users, #TBD
        'c': list_cases, #TBD
        '?': get_help_user,
        'x': exit_level,
        '!': complete_case, #TBD
        'r.': start_report, #TBD
        'r!': close_report, #TBD
        'v.': start_sale, #TBD
        'v!': complete_sale, #TBD
    }
    next_interaction_failure: error_command
    save_field_context:
        field: conversational_level
        value: user

#This converts the context 'new_user_info' to the different context data
add_user:
    type: 'pre_register_user'
    requires_user_response: 'false'
    next_interaction: register_user

register_user:
    type: 'register_user'
    requires_user_response: 'false'
    next_interaction: conversation_start

conversation_start:
    type: 'text'
    text: "¬°Listo! Haz registrado a ${new_user_info_name}(${new_user_info_phone})"
    requires_user_response: 'false'
    next_interaction: 'presentation'

presentation:
    type: 'text'
    text: "Escribe tu primer mensaje (ejemplo: m hola!)"
    requires_user_response: 'true'
    next_interaction: message_user

message_user:
    type: 'redirect_message'
    requires_user_response: 'false'
    next_interaction: if_general_or_user

move_to_user:
    type: switch_user
    requires_user_response: 'false'
    next_interaction: if_general_or_user

exit_level:
    type: exit_level
    requires_user_response: 'false'
    next_interaction: if_general_or_user

get_help_user:
    type: 'text'
    text: "+u - loop de generar usuario - flow con retro\nu - moverse a un usuario - setup \nls- listar usuarios - flow sin retro\nc - listar casos - flow sin retro\n? - Obtener ayuda  - flow sin retro\nm - mandar mensaje - flow sin retro\nx - salir CUI - flow sin retro\nXX Salir del nivel - flow sin retro\n! Completar caso abierto - setup\nr. crear reporte abierto - setup\nr! Completar reporte abierto - setup\nv. crear venta - setup\nv! Completar venta - setup"
    requires_user_response: 'false'
    next_interaction: user_interface

if_general_or_user:
    type: if_general_or_user
    requires_user_reponse: 'false'
    general_interaction: 'general_interface'
    user_interaction: 'user_interface'

attend_new_message:
    type: attend_new_message
    requires_user_reponse: 'false'
    next_interaction: if_general_or_user
